<!DOCTYPE html>
<html lang="ru">
<head>
    <title>UserScripts - Пользовательские скрипты</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="shower/themes/ribbon/styles/styles.css">
    <style>
        .shower {
            --slide-ratio: calc(16 / 9);
        }

        .slide code {
            font-family: monospace;
            font-size: 0.7em;
            line-height: 1.1em;
            display: block;
            white-space: pre;
            padding: 1em 1em;
        }

        .slide code .code_comment {
            color:#808080;
        }

        .slide code .code_meta_name {
            color:#0073bf
        }

        .test-icon {
            height: 1em;
            margin: -.4em .1em -.1em 0;
            vertical-align: middle;
            display: inline-block;
        }

        .slide, .overflow_hidden {
            overflow: hidden;
        }

        .round {
            border-radius: 100%;
        }

        .qr img {
            border: 5px solid #000;
            border-radius: 25px;
        }

        .slide .shout {
            font-size: 110px;
            font-size: 56px;
        }

        .img-wrap {
            max-height: 250px;
            overflow: hidden;
            position: relative;
        }

        .img-wrap:before {
            position: absolute;
            content: '';
            display: block;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            box-shadow: inset 0 -345px 25px -300px #ffffff;
        }

        .img-wrap img {
            max-width: 100%;
        }
    </style>
    <script>
        window.addEventListener('load', function onLoad() {
          document.body.querySelectorAll('code').forEach(function onMatch(el) {
            el.innerHTML = el.innerHTML.replace(/^\s{12}/mg, '').trim()
          })
        });
    </script>
</head>
<body class="shower list">
    <header class="caption">
        <h1>UserScripts - Пользовательские скрипты</h1>
        <p>Зачем нужны, чем могут помочь и где они обитают</p>
    </header>

    <section class="slide" id="title1">
        <div style="text-align: center; margin-top: 150px; font-size: 23px;">
            <h2 style="font-size: 56px">UserScripts - Пользовательские скрипты</h2>
            <p>Зачем нужны, чем могут помочь и где они обитают</p>
            <p style="position: absolute; bottom: 36px; right: 36px; text-align: right;">@flyink (Котляров Евгений)</p>
        </div>
    </section>

    <section class="slide" id="hello">
        <div class="avatar">
            <img src="./pictures/me2.png" width="300" alt="me">
        </div>
        <div class="overflow_hidden">
            <h2 class="double_line">Котляров Евгений</h2>
            <ul class="size_32">
                <li>
                    <img src="./pictures/emoji/male-technologist.png" class="test-icon" alt="emoji male technologist"/>
                    Разработчик <span class="blue">ВКонтакте</span>
                </li>
                <li>
                    <img src="./pictures/emoji/hammer.png" class="test-icon" alt="emoji hammer"/>
                    Отвечаю за платформу ботов
                </li>
                <li>
                    <img src="./pictures/emoji/sparkles.png" class="test-icon" alt="emoji sparkles"/>
                    Люблю делать жизнь проще
                </li>
            </ul>
        </div>
        <style>
            .avatar {
                float: left;
                margin-right: 2em;
            }
        </style>
    </section>

    <section class="slide" id="what">
        <h2>
            <img src="./pictures/emoji/female-teacher.png" class="test-icon" alt=""/>
            Что такое UserScript?
        </h2>
        <figure>
            <blockquote class="next">JavaScript код, который хранится у пользователя и выполняет действия на определенных страницах</blockquote>
        </figure>
    </section>

    <section class="slide">
        <h2>
            <img src="./pictures/emoji/thinking-face.png" class="test-icon" alt=""/>
            Зачем нужны?
        </h2>
        <ol>
            <li class="next">Автоматизация шаблонных действий</li>
            <li class="next">Добавление функционала на сторонние сайты</li>
            <li class="next">Исправление фич и багов</li>
            <li class="next">Добавление функционала, непригодного для продакшна</li>
        </ol>
    </section>

    <section class="slide" id="what_can_do">
        <h2>
            <img src="./pictures/emoji/face-with-monocle.png" class="test-icon" alt=""/>
            Что умеют?
        </h2>
        <ol>
            <li class="next">Выполнять JS в контексте расширения</li>
            <li class="next">Вызывать API расширения</li>
            <li class="next">Делать всякие гадости с вашим сайтом</li>
        </ol>
        <div class="img-wrap next">
            <img src="pictures/vk-ok.png" alt=""/>
        </div>
    </section>

    <section class="slide" id="where">
        <h2 class="shout">Где работают пользовательские скрипты?</h2>
    </section>

    <section class="slide" id="where_exec_Greasemonkey">
        <h2>
            <img src="./pictures/icons/Greasemonkey.png" class="test-icon" alt="Greasemonkey logo"/>
            Greasemonkey
        </h2>
        <ol>
            <li><a href="https://greasespot.net" target="_blank">greasespot.net</a></li>
            <li>Дата выхода: 28 марта 2005 года (до Появления Chrome)</li>
        </ol>
        <blockquote style="margin-top: 50px;">
            Проект Greasemonkey написан Aaron Boodman в 28 ноябре 2004 года, который был вдохновлен Firefox расширением, которое очищало интерфейс сайта AllMusic. К маю 2005 года для Greasemonkey было создано около 60 общих и 115 специфичных для сайта пользовательских скриптов.
        </blockquote>
    </section>

    <section class="slide" id="where_exec_Tampermonkey">
        <h2>
            <img src="./pictures/icons/Tampermonkey_logo.png" class="test-icon" alt="Tampermonkey logo"/>
            Tampermonkey
        </h2>
        <ol>
            <li><a href="https://tampermonkey.net" target="_blank">tampermonkey.net</a></li>
            <li>Доступен на Chrome, Microsoft Edge, Safari, Opera и Firefox.</li>
        </ol>
        <blockquote style="margin-top: 50px;">
            Tampermonkey был написан Jan Biniok в мае 2010 года из Greasemonkey, который уже был встроен в Chrome, но не имел полной совместимости.
        </blockquote>
    </section>

    <section class="slide" id="design">
        <h2>
            <img src="./pictures/emoji/detective.png" class="test-icon" alt="google chrome logo"/>
            Интерфейс
        </h2>
        <div style="overflow: hidden; width: 100%; height: 340px;">
            <div class="img-wrap">
                <img src="pictures/greasemonkey.png" alt="chome block userscript"/>
            </div>
            <div class="img-wrap">
                <img src="pictures/tampermonkey.png" alt="chome block userscript"/>
            </div>
        </div>
        <style>
            #design .img-wrap {
                width: 50%;
                max-height: 350px;
                float: left;
                border-radius: 3px;
            }

            #design .img-wrap:before {
                box-shadow: inset 345px -345px 20px -300px #ffffff;
            }
        </style>
    </section>

    <section class="slide" id="where_browser">
        <h2>
            <img src="./pictures/icons/google-chrome.png" class="test-icon" alt="google chrome logo"/>
            Google Chrome
        </h2>
        <p>C февраля 2009 года в Google Chrome появилась встроенная поддержка пользовательских скриптов в формате Greasemonkey, но позже установка пользовательских скриптов с посторонних доменов была отключена.</p>
        <div class="img-wrap" style="max-height: 250px;">
            <img src="pictures/chrome-us.png" alt="chome block userscript" width="948"/>
        </div>
    </section>

    <section class="slide" id="where_bookmarklets">
        <h2>
            <img src="./pictures/emoji/white-medium-star.png" class="test-icon" alt=""/>
            В закладках
        </h2>
        <ol>
            <li>Букмарклеты - JS в закладках</li>
            <li>Запускается на любой странице при нажатии на закладку</li>
            <li>Нужно вызывать панель закладок</li>
        </ol>
        <div class="img-wrap">
            <img src="pictures/favlets.png" alt="chome block userscript" width="948"/>
        </div>
    </section>

    <section class="slide" id="how_create_title">
        <h2 class="shout">Из чего состоит?</h2>
    </section>

    <section class="slide" id="how_create">
        <h2>
            <img src="./pictures/emoji/memo.png" class="test-icon" alt=""/>
            Состав:
        </h2>
        <ol>
            <li>Файл с «.user.js» в конце названия</li>
            <li>Метаданные</li>
            <li>JavaScript Код</li>
        </ol>
    </section>

    <section class="slide" id="how_create_frame">
        <h2>
            <img src="./pictures/emoji/gear.png" class="test-icon" alt=""/>
            Метаданные
        </h2>
        <code class="code code_comment">
            // ==UserScript==
            // <span class="code_meta_name">@name</span>         Название скрипта
            // <span class="code_meta_name">@namespace</span>    http://domain.com/
            // <span class="code_meta_name">@version</span>      0.1
            // <span class="code_meta_name">@description</span>  Описание
            // <span class="code_meta_name">@author</span>       Flyink13
            // <span class="code_meta_name">@match</span>        https://*.domain.com/
            // <span class="code_meta_name">@require</span>      http://www.example.com/example.js
            // <span class="code_meta_name">@resource</span>     resourceName http://www.example.com/example.png
            // <span class="code_meta_name">@run-at</span>       document-end|document-start|document-idle
            // <span class="code_meta_name">@grant</span>        GM.xmlHttpRequest
            // ==/UserScript==
            // Ваш скрипт
        </code>
        <a target="_blank" href="https://wiki.greasespot.net/Metadata_Block">Подробнее о Метаданных пользовательских скриптов</a>
    </section>

    <section class="slide" id="meta_name">
        <h2>
            <img src="./pictures/emoji/label.png" class="test-icon" alt=""/>
            Описание скрипта
        </h2>
        <code class="code code_comment">
            // <span class="code_meta_name">@name</span>         Название скрипта
            // <span class="code_meta_name">@namespace</span>    http://domain.com/
            // name + namespace - формируют id скрипта
            // <span class="code_meta_name">@version</span>      0.1
            // <span class="code_meta_name">@description</span>  Описание
            // <span class="code_meta_name">@updateURL</span>    https://openuserjs.org/meta/....meta.js
        </code>
    </section>

    <section class="slide" id="meta_include">
        <h2>
            <img src="./pictures/emoji/label.png" class="test-icon" alt=""/>
            Определение набора страниц
        </h2>
        <code class="code code_comment">
            // Добавить
            // <span class="code_meta_name">@include</span>      https://domain.com/*
            // <span class="code_meta_name">@match</span>        https://*.domain.com/
            // Исключить
            // <span class="code_meta_name">@exclude</span>      https://domain.com/image/
            // Отключить в фреймах
            // <span class="code_meta_name">@noframes</span>
        </code>
    </section>

    <section class="slide" id="run_at_types">
        <h2>@run-at</h2>
        <ul>
            <li><b>document-end</b> - после загрузки страницы, но до загрузки других ресурсов</li>
            <li><b>document-start</b> - до загрузки документа и до запуска любых сценариев</li>
            <li><b>document-idle</b> - После загрузки документа и запуска сценариев страницы</li>
        </ul>
    </section>

    <section class="slide" id="meta_grant">
        <h2>
            <img src="./pictures/emoji/wrench.png" class="test-icon" alt=""/>
            Дополнительное API
        </h2>
        <code class="code code_comment">
            // Получение метаданных скрипта:
            // <span class="code_meta_name">@grant</span>        GM.info
            // Аналог localStorage в контексте расширения:
            // <span class="code_meta_name">@grant</span>        GM.deleteValue/getValue/setValue/listValues
            // Вывод уведомлений:
            // <span class="code_meta_name">@grant</span>        GM.notification
            // Открытие новой вкладки:
            // <span class="code_meta_name">@grant</span>        GM.openInTab
            // Копирование в буффер обмена
            // <span class="code_meta_name">@grant</span>        GM.setClipboard
        </code>
    </section>

    <section class="slide" id="meta_resource">
        <h2>GM.getResourceUrl</h2>
        <code class="code code_comment">
            // ==UserScript==
            // @name Image resource example
            // @resource logo ../icons/laptop.png
            // @grant GM.getResourceUrl
            // ==/UserScript==
            <span />
            (async function() {
                let img = document.createElement("img");
                img.src = await GM.getResourceUrl("logo");
                document.body.appendChild(img);
            })();
        </code>
    </section>

    <section class="slide" id="meta_resource_xhr">
        <h2>GM.xmlHttpRequest</h2>
        <code class="code code_comment">
            GM.xmlHttpRequest({
              method: "POST",
              url: "http://www.example.net/login",
              data: "username=flyink13&password=zhylikNeVorui",
              headers: {
                "Content-Type": "application/x-www-form-urlencoded"
              },
              onload: function(response) {
                if (response.responseText.indexOf("Logged in as") > -1) {
                  location.href = "http://www.example.net/dashboard";
                }
              }
            });
        </code>
    </section>

    <section class="slide" id="helpers">
        <h2>
            <img src="./pictures/emoji/hocho.png" class="test-icon" alt=""/>
            Наши помощники в JS
        </h2>
        <ol>
            <li>MutationObserver - Отслеживаем мутации</li>
            <li>window.addEventListener - Реагируем на действия пользователя</li>
            <li>setInterval - Реагируем по времени</li>
            <li>Proxy, getter и setter - Отслеживаем взаимодействие с объектами</li>
            <li>Оборачиваем и заменям функции</li>
        </ol>
    </section>

    <section class="slide" id="mutation_observer">
        <h2>MutationObserver</h2>
        <code class="code code_comment">
            // Когда нужно что-то отрисовать в определенных елементах
            searchGreenElements(document.body);
            <span/>
            new MutationObserver(function onMutations(mutations) {
                mutations.forEach(function onMutation(mutation) {
                    searchGreenElements(mutation.target);
                });
            }).observe(document.body, {
                subtree: true,
                childList: true,
            });
            <span/>
            function searchGreenElements(el) {
                el.querySelectorAll('.green').forEach(function onMatchElement(el) {
                  el.style.background = 'red';
                });
            }
        </code>
    </section>

    <section class="slide" id="addEventListener">
        <h2>window.addEventListener</h2>
        <code class="code code_comment">
            // Когда нужно что-то обновить при действии пользователя
            window.addEventListener('keydown', function onKeyDown(event) {
                if (event.target.classList.contains('support_message_input')) {
                    showAndFilterHelpList(event.target);
                }
            });
        </code>
    </section>

    <section class="slide" id="setInterval">
        <h2>setInterval</h2>
        <code class="code code_comment">
            // Когда нужно что-то сделать по интервалу
            setInterval(function onTick() {
                window.postMessage('4 8 15 16 23 42');
            }, 108);
        </code>
    </section>

    <section class="slide" id="inject">
        <h2>
            <img src="./pictures/emoji/tractor.png" class="test-icon" alt=""/>
            Переходим в scope страницы
        </h2>
        <code class="code code_comment">
            // Встраиваем наш скрипт в станицу
            (function injectScript(fn) {
                var script = document.createElement('script');
                script.textContent = '(' + fn + ')();';
                script.id = fn.name;
                document.head.appendChild(script);
            })(function FastGroupTemplates () {
                // наш код
            });
        </code>
    </section>

    <section class="slide" id="Proxy">
        <h2>Proxy, getter и setter</h2>
        <code class="code code_comment">
            // Когда нужно заменять объект или отслеживать его
            Object.defineProperty(store, "adsLists", {
                set: function() {
                    // хе-хе
                    return [];
                },
                get: function() {
                    return [];
                }
            });
        </code>
    </section>

    <section class="slide" id="functionReplace">
        <h2>
            <img src="./pictures/emoji/flying-saucer.png" class="test-icon" alt=""/>
            Замена функций
        </h2>
        <code class="code code_comment">
            // Когда нужно изменить поведение функции
            ajax.post = (function replaceFunction(ajaxPost) {
                return function ajaxPostFake() {
                    var query = arguments[1];
                    if (/^лол$/i.test(query.msg)) {
                        query.msg = 'Смеюсь';
                    }
                    return ajaxPost.apply(this, arguments);
                }
            })(ajax.post);
        </code>
    </section>

    <section class="slide" id="storage">
        <h2>
            <img src="./pictures/emoji/anchor.png" class="test-icon" alt=""/>
            Где они обитают?
        </h2>
        <ol>
            <li><a href="https://openuserjs.org/" target="_blank">OpenUserJS</a></li>
            <li><a href="https://gist.github.com/" target="_blank">gist.github.com</a></li>
            <li><a href="https://habr.com/ru/post/226053/" target="_blank">Другие источники</a></li>
            <li><a href="#where_bookmarklets" target="_blank">В закладках</a></li>
        </ol>
    </section>

    <section class="slide" id="source">
        <h2>Материалы</h2>
        <ol>
            <li><a href="https://habr.com/ru/post/129343/" target="_blank">Учимся писать userscript'ы</a></li>
            <li><a href="https://habr.com/ru/post/128809/" target="_blank">Автоматизация через Userscript</a></li>
            <li><a href="https://habr.com/ru/post/39431/" target="_blank">Укрощаем GreaseMonkey</a></li>
            <li><a href="https://ru.wikipedia.org/wiki/%D0%91%D1%83%D0%BA%D0%BC%D0%B0%D1%80%D0%BA%D0%BB%D0%B5%D1%82" target="_blank">Букмарклет - wiki</a></li>
        </ol>
    </section>


    <section class="slide" id="view_this">
        <div class="avatar qr">
            <img src="./pictures/qr-ifx-su-p1.png" width="300" alt="qr code">
        </div>
        <div class="overflow_hidden" style="padding: 1em">
            <ul>
                <li>
                    <img src="./pictures/icons/vk.png" class="test-icon" alt="site icon vk"/>
                    ВКонтакте: <a href="https://vk.com/eee" target="_blank">@eee</a></li>
                <li>
                    <img src="./pictures/icons/tg.jpeg" class="test-icon" alt="site icon telegram"/>
                    Telegram: <a href="https://t.me/flyink" target="_blank">@flyink13</a>
                </li>
                <li>
                    <img src="./pictures/icons/twitter.png" class="test-icon" alt="site icon twitter"/>
                    Twitter: <a href="https://twitter.com/flyink13" target="_blank">@flyink13</a>
                </li>
                <li>
                    <img src="./pictures/icons/github.png" class="test-icon" alt="site icon github"/>
                    GitHub: <a href="https://github.com/FlyInk13" target="_blank">@flyink13</a>
                </li>
                <li>
                    <img src="./pictures/icons/openuserjs-3.png" class="test-icon round" alt="site icon openuserjs"/>
                    OpenUserJS: <a href="https://openuserjs.org/users/flyink13" target="_blank">@flyink13</a>
                </li>
                <li>
                    <img src="./pictures/icons/flyink.jpg" class="test-icon round" alt="site icon flyink"/>
                    Мой сайт: <a href="https://flyink.ru/" target="_blank">flyink.ru</a>
                </li>
            </ul>
        </div>
    </section>

    <footer class="badge">
        <a href="https://github.com/FlyInk13/About-UserScripts/">Fork me on GitHub</a>
    </footer>

    <div class="progress"></div>

    <script src="shower/shower.min.js"></script>
    <!-- Copyright © 3000 Yours Truly, Famous Inc. -->

</body>
</html>
